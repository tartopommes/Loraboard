{% extends 'base.html' %}

{% block content %}
    <div class="container-fluid px-5">
		<div class="row justify-content-center flex-column flex-md-row">

			{% if current_user.delete_success %}
			<div class="col-md-8 my-5 text-center">
				<div class="alert alert-success" role="alert">
					Account successful deleted
				</div>
			</div>
			{% endif %}
				
			{% if current_user.is_authenticated %}
			<!-- PLOT -->
			<div class="col-md-6 text-center">
				<div class="card my-5">
					<div class="card-body">
						<div id="plot-div">
							{{ plot.html|safe }}
						</div>
					</div>
					<!-- CHANGE LIMIT -->
					<div class="row justify-content-center my-3">
						<div class="col-md-4">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Alert value:</span>
								</div>
								<input type="number" class="form-control" id="input-limit" name="limit" min="0.0" max="15.0" step="0.1" value="{{ plot.limit }}">
								<small id="emailHelp" class="form-text text-muted">Set the value limit for email alerts.</small>
							</div>
						</div>	
					</div>
				</div>
			</div>
			<!-- TABLE -->
			<div class="col-md-6 text-center my-5">
				<div class="card" id="plot-table">
					{{ plot.table|safe }}
				</div>
			</div>

			{% else %}
			<div class="col-md-8 my-5 text-center">

				<img src="{{ url_for('static', filename='mkr.png') }}" class="img-fluid">
				<div class="row align-items-center justify-content-center my-5">
					<div class="text-center">
						<h3 class="mb-4">Please log in or register first to perform actions.</h3>
						<!-- <a href="{{ url_for('login') }}" class="btn btn-primary">Login</a> -->
					</div>
				</div>
			</div>
			{% endif %}
		</div>

		{% if current_user.is_authenticated %}
		<!-- ALERT -->
		<div class="row justify-content-center">
			<div class="col-md-6 text-center" id="alert-box">
			</div>
		</div>

		<!-- JQUERY -->
		<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
		<!-- SOCKET.IO -->
		<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.min.js"></script>
		<!-- PLOTLY -->
		<script>
			$(document).ready(function() {
				let socket = io.connect('http://' + document.domain + ':' + location.port);

				// [RECEIVE] Update plot and table
				socket.on('update', function(data) {
					$('#plot-div').html(data.html_plot);
					$('#plot-table').html(data.table);
				});

				// [SEND] Update alert value
				$('#input-limit').change(function() {
					socket.emit('set_alert_value', {'alert_value': $('#input-limit').val()});
				});
				
				// [RECEIVE] 
				socket.on('alert', function(data) {
					$('#alert-box').append(data);
				});
			});
		</script>
		{% endif %}
	</div>
{% endblock %}
</html>
